<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JS 性能优化 | Dxx</title>
    <meta name="description" content="我的个人网站">
    
    
    <link rel="preload" href="/blog/assets/css/0.styles.97723510.css" as="style"><link rel="preload" href="/blog/assets/js/app.59dd1e58.js" as="script"><link rel="preload" href="/blog/assets/js/2.ed64cbc4.js" as="script"><link rel="preload" href="/blog/assets/js/51.dc729e71.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.a26a388f.js"><link rel="prefetch" href="/blog/assets/js/11.b08142ad.js"><link rel="prefetch" href="/blog/assets/js/12.0b4acb3d.js"><link rel="prefetch" href="/blog/assets/js/13.6c81cc3c.js"><link rel="prefetch" href="/blog/assets/js/14.f1b449d4.js"><link rel="prefetch" href="/blog/assets/js/15.eff9695d.js"><link rel="prefetch" href="/blog/assets/js/16.c2393374.js"><link rel="prefetch" href="/blog/assets/js/17.183df7d2.js"><link rel="prefetch" href="/blog/assets/js/18.c92e3cbe.js"><link rel="prefetch" href="/blog/assets/js/19.48df1c97.js"><link rel="prefetch" href="/blog/assets/js/20.c20acfbb.js"><link rel="prefetch" href="/blog/assets/js/21.6b105aed.js"><link rel="prefetch" href="/blog/assets/js/22.2ee2d1ab.js"><link rel="prefetch" href="/blog/assets/js/23.e6c6da0c.js"><link rel="prefetch" href="/blog/assets/js/24.4f7ae69f.js"><link rel="prefetch" href="/blog/assets/js/25.3ae186d9.js"><link rel="prefetch" href="/blog/assets/js/26.46f2a568.js"><link rel="prefetch" href="/blog/assets/js/27.66eea6e6.js"><link rel="prefetch" href="/blog/assets/js/28.eb2db7a7.js"><link rel="prefetch" href="/blog/assets/js/29.c09172de.js"><link rel="prefetch" href="/blog/assets/js/3.9676fb81.js"><link rel="prefetch" href="/blog/assets/js/30.672acbb4.js"><link rel="prefetch" href="/blog/assets/js/31.6d412037.js"><link rel="prefetch" href="/blog/assets/js/32.4a305c18.js"><link rel="prefetch" href="/blog/assets/js/33.54b78c7d.js"><link rel="prefetch" href="/blog/assets/js/34.64f1b5b4.js"><link rel="prefetch" href="/blog/assets/js/35.78a7c904.js"><link rel="prefetch" href="/blog/assets/js/36.ae34d791.js"><link rel="prefetch" href="/blog/assets/js/37.d45e896c.js"><link rel="prefetch" href="/blog/assets/js/38.a5b4ad61.js"><link rel="prefetch" href="/blog/assets/js/39.bf33bc5f.js"><link rel="prefetch" href="/blog/assets/js/4.3ff2fe10.js"><link rel="prefetch" href="/blog/assets/js/40.ca31cf3b.js"><link rel="prefetch" href="/blog/assets/js/41.2ab354e6.js"><link rel="prefetch" href="/blog/assets/js/42.df169f3e.js"><link rel="prefetch" href="/blog/assets/js/43.4dbaa714.js"><link rel="prefetch" href="/blog/assets/js/44.afff9001.js"><link rel="prefetch" href="/blog/assets/js/45.483a1088.js"><link rel="prefetch" href="/blog/assets/js/46.ea195f33.js"><link rel="prefetch" href="/blog/assets/js/47.442c5353.js"><link rel="prefetch" href="/blog/assets/js/48.639ecdd5.js"><link rel="prefetch" href="/blog/assets/js/49.264a0999.js"><link rel="prefetch" href="/blog/assets/js/5.fb52156e.js"><link rel="prefetch" href="/blog/assets/js/50.dc0e4201.js"><link rel="prefetch" href="/blog/assets/js/52.84d0237c.js"><link rel="prefetch" href="/blog/assets/js/53.fb9ad354.js"><link rel="prefetch" href="/blog/assets/js/54.51a2ca96.js"><link rel="prefetch" href="/blog/assets/js/55.d2539702.js"><link rel="prefetch" href="/blog/assets/js/56.27f1a53f.js"><link rel="prefetch" href="/blog/assets/js/57.5190a293.js"><link rel="prefetch" href="/blog/assets/js/58.30fd501c.js"><link rel="prefetch" href="/blog/assets/js/59.c099280d.js"><link rel="prefetch" href="/blog/assets/js/6.6eb5bf86.js"><link rel="prefetch" href="/blog/assets/js/60.6d36227f.js"><link rel="prefetch" href="/blog/assets/js/61.b898742b.js"><link rel="prefetch" href="/blog/assets/js/62.d2ead175.js"><link rel="prefetch" href="/blog/assets/js/63.98d1cf1a.js"><link rel="prefetch" href="/blog/assets/js/64.90938e2c.js"><link rel="prefetch" href="/blog/assets/js/65.56c04b43.js"><link rel="prefetch" href="/blog/assets/js/66.908e93f2.js"><link rel="prefetch" href="/blog/assets/js/67.f1c7a048.js"><link rel="prefetch" href="/blog/assets/js/68.96bc93ce.js"><link rel="prefetch" href="/blog/assets/js/69.027953af.js"><link rel="prefetch" href="/blog/assets/js/7.26e0352d.js"><link rel="prefetch" href="/blog/assets/js/70.634b4d54.js"><link rel="prefetch" href="/blog/assets/js/71.cdb047a0.js"><link rel="prefetch" href="/blog/assets/js/72.a95a35d3.js"><link rel="prefetch" href="/blog/assets/js/73.676108f1.js"><link rel="prefetch" href="/blog/assets/js/74.5379b98f.js"><link rel="prefetch" href="/blog/assets/js/75.cbed0340.js"><link rel="prefetch" href="/blog/assets/js/8.483402c4.js"><link rel="prefetch" href="/blog/assets/js/9.b32ee200.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.97723510.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">Dxx</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">Home</a></div><div class="nav-item"><a href="https://github.com/Dxxxxxxww" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  External
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">Home</a></div><div class="nav-item"><a href="https://github.com/Dxxxxxxww" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  External
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Browser</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Css</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Element</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Engineering</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Js</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Keshihua</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Others</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Performance</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/performance-module/001-JS性能优化.html" class="active sidebar-link">JS 性能优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/performance-module/001-JS性能优化.html#内存管理" class="sidebar-link">内存管理</a></li><li class="sidebar-sub-header"><a href="/blog/performance-module/001-JS性能优化.html#js-垃圾回收" class="sidebar-link">js 垃圾回收</a></li></ul></li><li><a href="/blog/performance-module/002-性能优化.html" class="sidebar-link">性能优化</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Reg</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Ts</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Utils</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Web</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="js-性能优化"><a href="#js-性能优化" class="header-anchor">#</a> JS 性能优化</h1> <p><a href="https://jsbench.me/" target="_blank" rel="noopener noreferrer">查看 js 性能优化的网站<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="内存管理"><a href="#内存管理" class="header-anchor">#</a> 内存管理</h2> <h3 id="内存介绍"><a href="#内存介绍" class="header-anchor">#</a> 内存介绍</h3> <p>内存：由读写单元组成，表示一片可操作的空间。</p> <p>进程：是 cpu 资源分配的最小单位，系统会给它分配内存。</p> <p>线程：是 cpu 调度的最小单位</p> <h2 id="js-垃圾回收"><a href="#js-垃圾回收" class="header-anchor">#</a> js 垃圾回收</h2> <p>当一片内存空间没有变量引用，变成不可达到的空间时，就会被 js 进行垃圾回收。</p> <h3 id="常见-gc-算法"><a href="#常见-gc-算法" class="header-anchor">#</a> 常见 GC 算法</h3> <ol><li>引用计数，通过数字来判断是否需要回收；</li> <li>可达性分析算法：标记清除，给正在使用的对象(空间)打上标记，来判断是否需要回收；</li> <li>标记整理，与标记清除类似，只不过在回收时有差异；</li> <li>分代回收，V8。</li></ol> <h4 id="引用计数原理"><a href="#引用计数原理" class="header-anchor">#</a> 引用计数原理</h4> <p>通过引用计数器，设置引用数，如果为 0 表示没有引用，则可以进行回收。<b>核心是引用数是否为 0。</b></p> <p>优点：</p> <ol><li>发现垃圾时立即回收；</li> <li>最大限度减少程序暂停。由于引用计数器一直监视着引用为 0 的对象，所以当内存即将到达瓶颈时，就会立即回收这些对象，减少程序暂停的频率。</li></ol> <p>缺点：</p> <ol><li>无法回收循环引用的对象；</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">fn</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        obj2 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    obj1<span class="token punctuation">.</span>next <span class="token operator">=</span> obj2<span class="token punctuation">;</span>
    obj2<span class="token punctuation">.</span>prev <span class="token operator">=</span> obj1<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><ol start="2"><li>时间开销大。引用计数器的存在，需要时刻监视对象的引用计数是否需要更改，并且修改引用数值也需要耗时，对象越多，需要的操作也越多，时间开销越大。</li></ol> <h4 id="标记清除"><a href="#标记清除" class="header-anchor">#</a> 标记清除</h4> <p>标记清除会分为两个阶段，标记和清除。
从 GC Roots(全局) 出发，在标记阶段，会遍历所有对象，给活动的对象打上标记(标记为可达)。在清除阶段，会遍历所有对象，回收没有标记的对象(不可达的对象)，并且会将上一步打上的标记抹除，便于下次工作。</p> <p>如何解决循环引用？</p> <p><img src="/performance/bjqc.png" alt="image"></p> <p>如图，当两个对象除了彼此引用外，在一个作用域链上，在 GC Roots(全局) 向下搜索无法达到这两个对象时，这两个对象就可以被回收。<b>所以标记清除的核心是 GC Roots(全局) 是否可达对象。</b></p> <p>如何判断一个对象是否是可达的呢？</p> <p>比如说当函数 sayHi 在执行时，sayHi 在执行栈中存在，全局就有这个函数的引用，内部的变量自然是可以达到的。而当 sayHi 执行完出栈后，全局就无法达到内部的变量了。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">sayHi</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 在这里执行是，内部的 a 是可以访问到的</span>
<span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// sayHi 执行完了，内部的 a 无法达到</span>
</code></pre></div><p>优点：</p> <ol><li>可以解决循环引用；</li></ol> <p>缺点：</p> <ol><li>空间碎片化，当回收的对象在地址上是不连续的，由于是不连续的，在垃圾回收后，空闲区域就会分散在各个角落。而在后续使用这些空闲区域时，如果大小刚好就能直接使用，如果大小不合适就不能使用了，造成了内存浪费；</li> <li>在遍历的过程中即使发现了一个对象是不可达的，也不会立即去回收也要等到最后才去清除，并且当去清除的时候，程序是停止工作的。</li></ol> <h4 id="标记整理"><a href="#标记整理" class="header-anchor">#</a> 标记整理</h4> <p>可以理解为是标记清除的升级版，在清除阶段会先将对象进行整理，移动对象位置，然后成块的回收垃圾，解决空间碎片化的问题。</p> <h3 id="v8-垃圾回收策略"><a href="#v8-垃圾回收策略" class="header-anchor">#</a> v8 垃圾回收策略</h3> <p>采用分代回收的思想，将内存分为新生代和老生代。针对不同代采用不同算法。</p> <p>新生代：复制算法，标记整理。</p> <ul><li>新生代内存 64 位系统下是 32M ,32 位系统下是 16M</li> <li>空间复制的时候产生 From 和 To 二个等大小的空间，始终有一部分是空间不使用的，即使很小也是一种浪费，属于用空间换时间。</li></ul> <p>老生代：标记清除，标记整理，增量标记。</p> <ul><li>老生代内存 64 位系统下是 1.4G ,32 位系统下是 700M</li></ul> <h4 id="v8-为什么要限制内存大小"><a href="#v8-为什么要限制内存大小" class="header-anchor">#</a> v8 为什么要限制内存大小</h4> <ol><li>是因为对于浏览器来说这点内存给 js 运行已经非常足够。</li> <li>耗时问题。以 1.5G 的垃圾回收的堆内存为例，V8 做一次小的垃圾回收需求 50ms 以上，而做一次非增量标记回收甚至需要 1s 以上，严重影响用户体验。</li></ol> <h3 id="监控内存的几种方式"><a href="#监控内存的几种方式" class="header-anchor">#</a> 监控内存的几种方式</h3> <ol><li>浏览器任务管理器；</li> <li>timeline 时序图记录；</li> <li>堆快照查找分离 dom；</li> <li>判断是否存在频繁的垃圾回收。</li></ol> <h4 id="浏览器任务管理器"><a href="#浏览器任务管理器" class="header-anchor">#</a> 浏览器任务管理器</h4> <p>浏览器任务管理器 主要查看两列内存，一列是 dom 内存，一列是 JavaScript 内存。查看 dom 内存变动可知当前页面 dom 节点是否在新增/删除。查看 JavaScript 内存可知是否有内存泄漏情况。</p> <h4 id="timeline-时序图"><a href="#timeline-时序图" class="header-anchor">#</a> timeline 时序图</h4> <p>就是性能标签里打开录制后的图形界面。</p> <h4 id="堆快照查找分离-dom"><a href="#堆快照查找分离-dom" class="header-anchor">#</a> 堆快照查找分离 dom</h4> <p>内存标签里的堆快照。在执行某些操作前，后各拍一次快照。然后通过搜索 detach 来查找是否有分离 dom。</p> <p>分离 dom 就是一种内存泄漏。</p> <p>分离状态的 dom：指的是不在界面上显示，也不在 dom 树上，但是还在被对象引用着的 dom 节点。</p> <h4 id="gc-是否频繁的执行"><a href="#gc-是否频繁的执行" class="header-anchor">#</a> GC 是否频繁的执行</h4> <p>查看 timeline 中是否存在频繁的上升下降。查看任务管理器中内存数值是否频繁的增加减小。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">12/28/2021, 3:04:46 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/others-module/mac-battery-health.html" class="prev">mac-battery-health</a></span> <span class="next"><a href="/blog/performance-module/002-性能优化.html">性能优化</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.59dd1e58.js" defer></script><script src="/blog/assets/js/2.ed64cbc4.js" defer></script><script src="/blog/assets/js/51.dc729e71.js" defer></script>
  </body>
</html>
