<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>常见的 webpack5 配置 | Dxx</title>
    <meta name="description" content="我的个人网站">
    
    
    <link rel="preload" href="/blog/assets/css/0.styles.97723510.css" as="style"><link rel="preload" href="/blog/assets/js/app.59dd1e58.js" as="script"><link rel="preload" href="/blog/assets/js/2.ed64cbc4.js" as="script"><link rel="preload" href="/blog/assets/js/22.2ee2d1ab.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.a26a388f.js"><link rel="prefetch" href="/blog/assets/js/11.b08142ad.js"><link rel="prefetch" href="/blog/assets/js/12.0b4acb3d.js"><link rel="prefetch" href="/blog/assets/js/13.6c81cc3c.js"><link rel="prefetch" href="/blog/assets/js/14.f1b449d4.js"><link rel="prefetch" href="/blog/assets/js/15.eff9695d.js"><link rel="prefetch" href="/blog/assets/js/16.c2393374.js"><link rel="prefetch" href="/blog/assets/js/17.183df7d2.js"><link rel="prefetch" href="/blog/assets/js/18.c92e3cbe.js"><link rel="prefetch" href="/blog/assets/js/19.48df1c97.js"><link rel="prefetch" href="/blog/assets/js/20.c20acfbb.js"><link rel="prefetch" href="/blog/assets/js/21.6b105aed.js"><link rel="prefetch" href="/blog/assets/js/23.e6c6da0c.js"><link rel="prefetch" href="/blog/assets/js/24.4f7ae69f.js"><link rel="prefetch" href="/blog/assets/js/25.3ae186d9.js"><link rel="prefetch" href="/blog/assets/js/26.46f2a568.js"><link rel="prefetch" href="/blog/assets/js/27.66eea6e6.js"><link rel="prefetch" href="/blog/assets/js/28.eb2db7a7.js"><link rel="prefetch" href="/blog/assets/js/29.c09172de.js"><link rel="prefetch" href="/blog/assets/js/3.9676fb81.js"><link rel="prefetch" href="/blog/assets/js/30.672acbb4.js"><link rel="prefetch" href="/blog/assets/js/31.6d412037.js"><link rel="prefetch" href="/blog/assets/js/32.4a305c18.js"><link rel="prefetch" href="/blog/assets/js/33.54b78c7d.js"><link rel="prefetch" href="/blog/assets/js/34.64f1b5b4.js"><link rel="prefetch" href="/blog/assets/js/35.78a7c904.js"><link rel="prefetch" href="/blog/assets/js/36.ae34d791.js"><link rel="prefetch" href="/blog/assets/js/37.d45e896c.js"><link rel="prefetch" href="/blog/assets/js/38.a5b4ad61.js"><link rel="prefetch" href="/blog/assets/js/39.bf33bc5f.js"><link rel="prefetch" href="/blog/assets/js/4.3ff2fe10.js"><link rel="prefetch" href="/blog/assets/js/40.ca31cf3b.js"><link rel="prefetch" href="/blog/assets/js/41.2ab354e6.js"><link rel="prefetch" href="/blog/assets/js/42.df169f3e.js"><link rel="prefetch" href="/blog/assets/js/43.4dbaa714.js"><link rel="prefetch" href="/blog/assets/js/44.afff9001.js"><link rel="prefetch" href="/blog/assets/js/45.483a1088.js"><link rel="prefetch" href="/blog/assets/js/46.ea195f33.js"><link rel="prefetch" href="/blog/assets/js/47.442c5353.js"><link rel="prefetch" href="/blog/assets/js/48.639ecdd5.js"><link rel="prefetch" href="/blog/assets/js/49.264a0999.js"><link rel="prefetch" href="/blog/assets/js/5.fb52156e.js"><link rel="prefetch" href="/blog/assets/js/50.dc0e4201.js"><link rel="prefetch" href="/blog/assets/js/51.dc729e71.js"><link rel="prefetch" href="/blog/assets/js/52.84d0237c.js"><link rel="prefetch" href="/blog/assets/js/53.fb9ad354.js"><link rel="prefetch" href="/blog/assets/js/54.51a2ca96.js"><link rel="prefetch" href="/blog/assets/js/55.d2539702.js"><link rel="prefetch" href="/blog/assets/js/56.27f1a53f.js"><link rel="prefetch" href="/blog/assets/js/57.5190a293.js"><link rel="prefetch" href="/blog/assets/js/58.30fd501c.js"><link rel="prefetch" href="/blog/assets/js/59.c099280d.js"><link rel="prefetch" href="/blog/assets/js/6.6eb5bf86.js"><link rel="prefetch" href="/blog/assets/js/60.6d36227f.js"><link rel="prefetch" href="/blog/assets/js/61.b898742b.js"><link rel="prefetch" href="/blog/assets/js/62.d2ead175.js"><link rel="prefetch" href="/blog/assets/js/63.98d1cf1a.js"><link rel="prefetch" href="/blog/assets/js/64.90938e2c.js"><link rel="prefetch" href="/blog/assets/js/65.56c04b43.js"><link rel="prefetch" href="/blog/assets/js/66.908e93f2.js"><link rel="prefetch" href="/blog/assets/js/67.f1c7a048.js"><link rel="prefetch" href="/blog/assets/js/68.96bc93ce.js"><link rel="prefetch" href="/blog/assets/js/69.027953af.js"><link rel="prefetch" href="/blog/assets/js/7.26e0352d.js"><link rel="prefetch" href="/blog/assets/js/70.634b4d54.js"><link rel="prefetch" href="/blog/assets/js/71.cdb047a0.js"><link rel="prefetch" href="/blog/assets/js/72.a95a35d3.js"><link rel="prefetch" href="/blog/assets/js/73.676108f1.js"><link rel="prefetch" href="/blog/assets/js/74.5379b98f.js"><link rel="prefetch" href="/blog/assets/js/75.cbed0340.js"><link rel="prefetch" href="/blog/assets/js/8.483402c4.js"><link rel="prefetch" href="/blog/assets/js/9.b32ee200.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.97723510.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">Dxx</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">Home</a></div><div class="nav-item"><a href="https://github.com/Dxxxxxxww" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  External
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">Home</a></div><div class="nav-item"><a href="https://github.com/Dxxxxxxww" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  External
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Browser</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Css</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Element</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Engineering</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/engineering-module/001-工程化简介.html" class="sidebar-link">前端工程化</a></li><li><a href="/blog/engineering-module/002-构建工具.html" class="sidebar-link">构建工具</a></li><li><a href="/blog/engineering-module/003-使用nodejs开发自定义cli.html" class="sidebar-link">使用 nodejs 开发自定义 cli</a></li><li><a href="/blog/engineering-module/004-常见webpack5配置.html" class="active sidebar-link">常见的 webpack5 配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/engineering-module/004-常见webpack5配置.html#require" class="sidebar-link">* require</a></li><li class="sidebar-sub-header"><a href="/blog/engineering-module/004-常见webpack5配置.html#context" class="sidebar-link">context</a></li><li class="sidebar-sub-header"><a href="/blog/engineering-module/004-常见webpack5配置.html#output" class="sidebar-link">output</a></li><li class="sidebar-sub-header"><a href="/blog/engineering-module/004-常见webpack5配置.html#loader" class="sidebar-link">Loader</a></li><li class="sidebar-sub-header"><a href="/blog/engineering-module/004-常见webpack5配置.html#browserslist" class="sidebar-link">browserslist</a></li><li class="sidebar-sub-header"><a href="/blog/engineering-module/004-常见webpack5配置.html#plugin" class="sidebar-link">plugin</a></li><li class="sidebar-sub-header"><a href="/blog/engineering-module/004-常见webpack5配置.html#babel" class="sidebar-link">babel</a></li><li class="sidebar-sub-header"><a href="/blog/engineering-module/004-常见webpack5配置.html#output-2" class="sidebar-link">output</a></li><li class="sidebar-sub-header"><a href="/blog/engineering-module/004-常见webpack5配置.html#webpack-dev-server" class="sidebar-link">webpack-dev-server</a></li><li class="sidebar-sub-header"><a href="/blog/engineering-module/004-常见webpack5配置.html#hmr" class="sidebar-link">HMR</a></li><li class="sidebar-sub-header"><a href="/blog/engineering-module/004-常见webpack5配置.html#devserver" class="sidebar-link">devServer</a></li><li class="sidebar-sub-header"><a href="/blog/engineering-module/004-常见webpack5配置.html#resolve" class="sidebar-link">resolve</a></li><li class="sidebar-sub-header"><a href="/blog/engineering-module/004-常见webpack5配置.html#mode" class="sidebar-link">mode</a></li><li class="sidebar-sub-header"><a href="/blog/engineering-module/004-常见webpack5配置.html#devtool" class="sidebar-link">devtool</a></li><li class="sidebar-sub-header"><a href="/blog/engineering-module/004-常见webpack5配置.html#optimization" class="sidebar-link">optimization</a></li><li class="sidebar-sub-header"><a href="/blog/engineering-module/004-常见webpack5配置.html#tree-shaking" class="sidebar-link">tree-shaking</a></li><li class="sidebar-sub-header"><a href="/blog/engineering-module/004-常见webpack5配置.html#externals" class="sidebar-link">externals</a></li><li class="sidebar-sub-header"><a href="/blog/engineering-module/004-常见webpack5配置.html#dll" class="sidebar-link">dll</a></li><li class="sidebar-sub-header"><a href="/blog/engineering-module/004-常见webpack5配置.html#webpack-打包库" class="sidebar-link">webpack 打包库</a></li><li class="sidebar-sub-header"><a href="/blog/engineering-module/004-常见webpack5配置.html#暴露-react-的-webpack-配置" class="sidebar-link">暴露 react 的 webpack 配置</a></li><li class="sidebar-sub-header"><a href="/blog/engineering-module/004-常见webpack5配置.html#暴露-vue-的-webpack-配置" class="sidebar-link">暴露 vue 的 webpack 配置</a></li><li class="sidebar-sub-header"><a href="/blog/engineering-module/004-常见webpack5配置.html#其他-tips" class="sidebar-link">其他 tips</a></li></ul></li><li><a href="/blog/engineering-module/005-配置eslint-prettier-githook.html" class="sidebar-link">配置 eslint，prettier，githook</a></li><li><a href="/blog/engineering-module/006-常见rollup配置.html" class="sidebar-link">rollup</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Js</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Keshihua</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Others</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Performance</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Reg</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Ts</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Utils</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Web</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="常见的-webpack5-配置"><a href="#常见的-webpack5-配置" class="header-anchor">#</a> 常见的 webpack5 配置</h1> <p>webpack 是一个模块打包器（bundler），它能将多个 js 文件打包成一个文件。对于其他资源来说，webpack 就需要借助对应的 loader 来进行资源转化及加载。</p> <p>这里只是记录一下常用的配置，具体配置写法去官方文档里查询。<b>注：带 * 则表示 webpack5 中的新修改项目</b></p> <h2 id="require"><a href="#require" class="header-anchor">#</a> * require</h2> <p>webpack5 中 require 导入的是模块对象，其 default 才是真正的路径。</p> <ol><li>require('xx').default</li> <li>在对应 loader 的 options 中配置 esModule: false</li> <li>使用 import 导入资源</li></ol> <h2 id="context"><a href="#context" class="header-anchor">#</a> context</h2> <p>The base directory, an absolute path, for resolving entry points and loaders from the configuration.</p> <p>使用绝对路径定义基本目录，用于从配置中解析 entry 。</p> <p>entry 的相对路径就是相对于 context 而言的。</p> <h2 id="output"><a href="#output" class="header-anchor">#</a> output</h2> <h3 id="output-publicpath"><a href="#output-publicpath" class="header-anchor">#</a> output.publicPath</h3> <p>定义 index.html 引用的资源的基本路径</p> <h2 id="loader"><a href="#loader" class="header-anchor">#</a> Loader</h2> <p>对特定类型的文件做转换处理。像 css，图片，字体等等。工作时机确定 -&gt; 在读取文件内容时。在 module 下配置。</p> <h3 id="css-相关的-loader"><a href="#css-相关的-loader" class="header-anchor">#</a> css 相关的 loader</h3> <p>css 相关的 loader 有以下几种：</p> <ul><li>css-loader</li> <li>style-loader</li> <li>less-loader</li> <li>postcss-loader</li></ul> <p>loader 执行顺序是从右往左，从下往上。所以编写顺序应该是：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// postcss 使用 autoprefixer 来加前缀</span>
<span class="token comment">// postcss-preset-env 预设了很多 postcss 所需的插件。 xx-preset-env 预设插件集</span>
<span class="token comment">// *.css</span>
<span class="token punctuation">[</span><span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;postcss-loader&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// *.less</span>
<span class="token punctuation">[</span><span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;postcss-loader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;less-loader&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token punctuation">{</span>
    test<span class="token punctuation">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span>
    use<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token comment">// ...</span>
        <span class="token punctuation">{</span>
            loader<span class="token punctuation">:</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
            options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                <span class="token comment">// css 中又导入了其他css文件就需要这样处理</span>
                <span class="token comment">// 遇到需要被之前的 loader 再处理的文件的话，就修改这个步进值</span>
                <span class="token comment">// 1 就表示 只需要前面一个 -&gt; postcss-loader。 2 表示前面两个，以此类推</span>
                importLoaders<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                <span class="token comment">// background-url</span>
                <span class="token comment">// webpack5 中 require 导入的图片是一个模块对象，其 default 才是真正的路径</span>
                <span class="token comment">// 如果想要 require 直接导入路径，则使用以下配置</span>
                esModule<span class="token punctuation">:</span> <span class="token boolean">false</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">'postcss-loader'</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="图片，字体相关-loader"><a href="#图片，字体相关-loader" class="header-anchor">#</a> 图片，字体相关 loader</h3> <ul><li>file-loader</li></ul> <p>拷贝图片，分开请求。可以修改打包后的图片名称。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    test<span class="token punctuation">:</span> <span class="token regex">/\.(png|svg|gif|jpe?g)$/</span><span class="token punctuation">,</span>
    use<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            loader<span class="token punctuation">:</span> <span class="token string">'file-loader'</span><span class="token punctuation">,</span>
            options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                esModule<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token comment">// 不转为 esm</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>url-loader</li></ul> <p>将图片以 base64 的方式放入代码中，减少请求次数。</p> <p>url-loader 中可以调用 file-loader，设置图片大小上限，超出则用 file-loader 拷贝图片</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    test<span class="token punctuation">:</span> <span class="token regex">/\.(png|svg|gif|jpe?g)$/</span><span class="token punctuation">,</span>
    use<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            loader<span class="token punctuation">:</span> <span class="token string">'url-loader'</span><span class="token punctuation">,</span>
            options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                esModule<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 不转为 esm</span>
                limit<span class="token punctuation">:</span> <span class="token number">25</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token comment">// 25kb</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="assest"><a href="#assest" class="header-anchor">#</a> * assest</h3> <p>asset module type</p> <ol><li>asset/resource -&gt; file-loader</li> <li>asset/inline -&gt; url-loader</li> <li>asset/source -&gt; raw-loade 不常用</li> <li>asset -&gt; 自动选择是 base64 还是单独导出一个文件(就跟 url-loader 使用 limit 来做判断一样)</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 图片</span>
<span class="token punctuation">{</span>
    test<span class="token punctuation">:</span> <span class="token regex">/\.(png|svg|gif|jpe?g)$/</span><span class="token punctuation">,</span>
    type<span class="token punctuation">:</span> <span class="token string">'asset/resource'</span>
<span class="token punctuation">}</span>

<span class="token comment">// 字体</span>
output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 统一指定导出目录</span>
    assetModuleFilename<span class="token punctuation">:</span> <span class="token string">'images/[hash][ext][query]'</span>
<span class="token punctuation">}</span>

<span class="token punctuation">{</span>
    test<span class="token punctuation">:</span> <span class="token regex">/\.(ttf|woff2?)$/</span><span class="token punctuation">,</span>
    type<span class="token punctuation">:</span> <span class="token string">'asset/resource'</span><span class="token punctuation">,</span>
    <span class="token comment">// 指定特定目录</span>
    generator<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        filename<span class="token punctuation">:</span> <span class="token string">'static/[hash][ext][query]'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="ts-相关-loader"><a href="#ts-相关-loader" class="header-anchor">#</a> ts 相关 loader</h3> <ul><li>ts-loader: ts 有语法错误时可以在编译期间报错。做语法校验。</li> <li>babel-loader: ts 语法错误不会在编译期间报错，但是可以将一些 js 高阶语法做兼容处理。需要在 preset 中加上@babel/preset-typescript</li></ul> <p>解决办法: 使用 babel-loader 并在 npm 中添加脚本</p> <div class="language-js extra-class"><pre class="language-js"><code>scriptes<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">'build'</span><span class="token punctuation">:</span> <span class="token string">'npm run ts &amp;&amp; webpack'</span><span class="token punctuation">,</span>
    <span class="token string">'ts'</span><span class="token punctuation">:</span> <span class="token string">'tsc --noEmit'</span>  <span class="token comment">// noEmit 指的是不生成转换 js 文件。</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="browserslist"><a href="#browserslist" class="header-anchor">#</a> browserslist</h2> <p><a href="https://caniuse.com/usage-table" target="_blank" rel="noopener noreferrer">browsers-use<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 选择需要兼容的浏览器范围</span>
<span class="token comment">// package.json</span>
<span class="token comment">// 数组中项是 或关系</span>
<span class="token string">&quot;browserslist&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;&gt; 1%&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 市场占有率大于 1% 的浏览器 caniuse -&gt; Browser usage table</span>
    <span class="token string">&quot;last 2 versions&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;not ie &lt;= 8&quot;</span>
  <span class="token punctuation">]</span>

<span class="token comment">// .browserslistrc</span>
<span class="token operator">&gt;</span> <span class="token number">1</span><span class="token operator">%</span>
last <span class="token number">2</span> versions
not ie <span class="token operator">&lt;=</span> <span class="token number">8</span>
</code></pre></div><h2 id="plugin"><a href="#plugin" class="header-anchor">#</a> plugin</h2> <p>可以做更多事情，工作时机不固定。在 plugins 下配置。</p> <h3 id="clean-webpack-plugin"><a href="#clean-webpack-plugin" class="header-anchor">#</a> clean-webpack-plugin</h3> <p>用来删除/清理你的构建文件夹。</p> <div class="language-js extra-class"><pre class="language-js"><code>plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="html-webpack-plugin"><a href="#html-webpack-plugin" class="header-anchor">#</a> html-webpack-plugin</h3> <p>简化了 HTML 文件的创建，为 webpack 打包服务。可自定 html 模板文件。</p> <div class="language-js extra-class"><pre class="language-js"><code>plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="webpack-defineplugin"><a href="#webpack-defineplugin" class="header-anchor">#</a> webpack.DefinePlugin</h3> <p>定义 webpack 全局变量</p> <div class="language-js extra-class"><pre class="language-js"><code>plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DefinePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token constant">BASE_SRC</span><span class="token punctuation">:</span> <span class="token string">'&quot;./&quot;'</span> <span class="token comment">// DefinePlugin 这里需要注意字符串要带上引号</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="copy-webpack-plugin"><a href="#copy-webpack-plugin" class="header-anchor">#</a> copy-webpack-plugin</h3> <p>拷贝文件，用来拷贝静态文件</p> <div class="language-js extra-class"><pre class="language-js"><code>plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">CopyWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="minicssextractplugin"><a href="#minicssextractplugin" class="header-anchor">#</a> * MiniCssExtractPlugin</h3> <p>文档上说 v5 版本才能使用，但是 v4 也能使用。抽离 css 成单独文件。更低版本可以使用 extract-text-webpack-plugin，v4+版本不推荐使用，会有问题。</p> <h3 id="cssminimizerwebpackplugin"><a href="#cssminimizerwebpackplugin" class="header-anchor">#</a> * CssMinimizerWebpackPlugin</h3> <p>对 css 文件进行压缩。v4 版本下可以使用 optimize-css-assets-webpack-plugin，此插件在 v5 版本无法压缩。</p> <h3 id="terserwebpackplugin"><a href="#terserwebpackplugin" class="header-anchor">#</a> TerserWebpackPlugin</h3> <p>压缩，丑化 js 代码。v5 版本已内置 TerserWebpackPlugin 插件。之前可能更多的是使用 uglify-js，但是 uglify-es 不再维护了，uglify-js 也不支持 es6+了。</p> <h3 id="moduleconcatenationplugin"><a href="#moduleconcatenationplugin" class="header-anchor">#</a> ModuleConcatenationPlugin</h3> <p>scope hoisting,也可以说是合并模块。会“提升”或将所有模块的作用域连接到一个闭包中，从而让代码在浏览器中有更快的执行时间。生产模式已经默认配置。依赖 ESM 在编译时导出/导入的静态分析，所以在 web 端最好都是用 ESM 而非 CMJ。</p> <h3 id="purgecss-webpack-plugin"><a href="#purgecss-webpack-plugin" class="header-anchor">#</a> purgecss-webpack-plugin</h3> <p>css tree-shaking 插件</p> <h3 id="compressionwebpackplugin"><a href="#compressionwebpackplugin" class="header-anchor">#</a> CompressionWebpackPlugin</h3> <p>优化手段。</p> <p>开启压缩，默认 gzip 算法。把资源压缩好给服务器，当浏览器支持 gzip 时，就可以使用已经压缩过的代码。</p> <h4 id="compressionwebpackplugin-minratio"><a href="#compressionwebpackplugin-minratio" class="header-anchor">#</a> CompressionWebpackPlugin.minRatio</h4> <p>压缩比，默认 0.8。如果设置太小，压缩算法没办法做到的话就不会去压缩。一般使用默认值 0.8 就行了。</p> <h3 id="inline-chunk-html-plugin"><a href="#inline-chunk-html-plugin" class="header-anchor">#</a> inline-chunk-html-plugin</h3> <p>将 js 代码注入 index.html 文件中。对于一些代码量少的文件，如果通过 script 外链的形式发请求来载入的话有点浪费，通过这个插件可以将代码量少的文件直接注入到 index.html 文件中。减少请求。</p> <h3 id="speed-measure-webpack-plugin"><a href="#speed-measure-webpack-plugin" class="header-anchor">#</a> speed-measure-webpack-plugin</h3> <p>分析 webpack-plugin，webpack-loader 的耗时。与 MiniCssExtractPlugin 有兼容问题，需要将 MiniCssExtractPlugin 降到 1.x 版本。</p> <h3 id="webpack-bundle-analyzer"><a href="#webpack-bundle-analyzer" class="header-anchor">#</a> webpack-bundle-analyzer</h3> <p>打包文件大小分析。</p> <h3 id="hotmodulereplacementplugin"><a href="#hotmodulereplacementplugin" class="header-anchor">#</a> HotModuleReplacementPlugin</h3> <p>HMR 的插件</p> <h3 id="commonschunkplugin"><a href="#commonschunkplugin" class="header-anchor">#</a> CommonsChunkPlugin</h3> <p>通过将公共模块从 bundle 中分离出来，得到的块文件可以在最初加载一次，并存储在缓存中供以后使用。这将导致页面速度优化，因为浏览器可以快速地从缓存提供共享代码，而不是在访问新页面时强制加载更大的包。</p> <h2 id="babel"><a href="#babel" class="header-anchor">#</a> babel</h2> <p>对 js 做兼容处理</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    test<span class="token punctuation">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
    use<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'babel-loader'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token comment">// babel.config.js</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    presets<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'@babel/preset-env'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="polyfill"><a href="#polyfill" class="header-anchor">#</a> * polyfill</h3> <p>对 babel 一些不能做转换的语法补充。webpack4 默认携带，webpack5 为了优化打包体积默认移除，需要用时添加即可。</p> <p>babel7 之后只需要添加 core-js regenerator-runtime 即可。</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    presets<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// false: 不对当前的 js 做 polyfill 处理</span>
            <span class="token comment">// usage：依据代码中所使用到的代码做兼容处理</span>
            <span class="token comment">// entry：依据 browserslist 选择的浏览器范围做处理</span>
            useBuiltIns<span class="token punctuation">:</span> <span class="token string">&quot;usage&quot;</span><span class="token punctuation">,</span>
            <span class="token comment">// 安装的 corejs 版本</span>
            corejs<span class="token punctuation">:</span> <span class="token number">3</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>如果一些第三方包已经使用了 @babel/polyfill，再在配置中使用 usage 做处理会有问题，这时候需要在 webpack 配置中给 babel-loader 添加 exclude: /node_modules/</p> <h3 id="如何根据模式有选择的使用-babel-插件"><a href="#如何根据模式有选择的使用-babel-插件" class="header-anchor">#</a> 如何根据模式有选择的使用 babel 插件</h3> <p>可以在 webpack 配置文件中给 process.env 手动挂载值，然后在 babelrc 中通过 process.env. 获取。如果单纯的通过 webpack.mode 设置的 process.env.NODE_ENV，在诸如 babelrc 这样的非模块文件中无法获取到。</p> <h4 id="why？"><a href="#why？" class="header-anchor">#</a> why？</h4> <p>究其原因是，在 webpack.mode 中设置模式，是通过 DefinePlugin 给 process.env.NODE_ENV 的值设置。这种全局变量在非模块配置文件中无法获取。而又因为配置文件的执行是归 webpack 控制，所以在 webpack 配置文件 中手动添加变量，是可以获取到的。也就是说 DefinePlugin 设置的全局变量只能在模块中使用。</p> <h2 id="output-2"><a href="#output-2" class="header-anchor">#</a> output</h2> <h3 id="publicpath"><a href="#publicpath" class="header-anchor">#</a> publicPath</h3> <p>规定了 index.html 如何去查找资源(js,css 等等)，域名 + publicPath + 资源</p> <h2 id="webpack-dev-server"><a href="#webpack-dev-server" class="header-anchor">#</a> webpack-dev-server</h2> <p><a href="https://webpack.js.org/guides/development/#using-watch-mode" target="_blank" rel="noopener noreferrer">详细<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>开发模式 --watch / watch: true 的不足：</p> <ol><li>所有源码都会重新编译；</li> <li>每次编译成功都需要进行文件读写；</li> <li>不能实现局部刷新。</li></ol> <p>使用 webpack-dev-server 就可以解决上述问题。vue, react 都是使用这个作为服务。</p> <h3 id="webpack-dev-middleware"><a href="#webpack-dev-middleware" class="header-anchor">#</a> webpack-dev-middleware</h3> <p>是一个包装器，它会将 webpack 处理过的文件发送给服务器。这在自定义服务内部使用，来达到自定义灵活度更高的服务的目的。相当于就是通过这个中间件来联系自定义 node 服务与 webpack。</p> <p>vue cli2 生成的 vue 项目 的 dev-server.js 就是这个。</p> <h3 id="webpack-hot-middleware"><a href="#webpack-hot-middleware" class="header-anchor">#</a> webpack-hot-middleware</h3> <p>热更新中间件，配合 webpack-dev-middleware 使用</p> <h2 id="hmr"><a href="#hmr" class="header-anchor">#</a> HMR</h2> <p>开启配置：设置 hot: true, hotOnly: true，再配上 HotModuleReplacementPlugin</p> <p>模块热更新，只更新改变的模块，而不会使整个页面都刷新。开启 HMR 之后，css 会直接启动模块热更新，因为 loader 已经做了这方面工作。为什么 js 不行，因为 js 模块是没有任何规律的，可能导出对象/变量/常量/函数，并且对于这些导出的东西的使用也各不相同。对于 css 而言，只需要把新的样式替换上去就行了。</p> <p>使用 vue/react 为什么可以呢？因为这两者的框架对于导出有着规则限制，是有一定规律的。框架内部已经提供好了通用 HMR 解决方案，vue-loader 内置了 hmr 的代码，react 则是通过 babel-preset，详细可以查看 webpack 文档 guides 中的 hmr 模块。</p> <p>hot 是 webpack-dev-server 的 hmr 配置。 webpack-hot-middleware 是 webpack-dev-middleware 设置的自定义服务的 hmr 配置。</p> <h2 id="devserver"><a href="#devserver" class="header-anchor">#</a> devServer</h2> <p>webpack-dev-server 的配置选项</p> <h3 id="devserver-publicpath"><a href="#devserver-publicpath" class="header-anchor">#</a> devServer.publicPath</h3> <p>指定本地服务所在的目录。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 配置目录之后</span>
devServer<span class="token punctuation">.</span>publicPath <span class="token operator">=</span> <span class="token string">'/lg'</span>
<span class="token comment">// 本地域名访问</span>
https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token punctuation">:</span><span class="token number">8080</span><span class="token operator">/</span>lg
</code></pre></div><p>大部分情况下，output.publicPath 与 devServer.publicPath 需要设置为相同的值。</p> <h3 id="devserver-contentbase"><a href="#devserver-contentbase" class="header-anchor">#</a> * devServer.contentBase</h3> <p>webpack5 文档中已不存在</p> <p>规定一些不被 webpack 打包的文件，但是在 index.html 中引用的资源去哪查找。绝对路径。</p> <h3 id="devserver-proxy"><a href="#devserver-proxy" class="header-anchor">#</a> devServer.proxy</h3> <p>跨域代理，转发请求。</p> <h3 id="devserver-compress"><a href="#devserver-compress" class="header-anchor">#</a> devServer.compress</h3> <p>开发服务启用 gzip 压缩。</p> <h2 id="resolve"><a href="#resolve" class="header-anchor">#</a> resolve</h2> <h3 id="resolve-alias"><a href="#resolve-alias" class="header-anchor">#</a> resolve.alias</h3> <p>别名</p> <h3 id="resolve-extensions"><a href="#resolve-extensions" class="header-anchor">#</a> resolve.extensions</h3> <p>文件引入时自动补全后缀</p> <h3 id="resolve-mainfiles"><a href="#resolve-mainfiles" class="header-anchor">#</a> resolve.mainFiles</h3> <p>引入文件夹时默认查找目录下的指定文件，默认值是 index。这也是为什么我们在文件夹下写 index 文件就能成功引入的原因。</p> <h3 id="resolve-modules"><a href="#resolve-modules" class="header-anchor">#</a> resolve.modules</h3> <p>引入模块时默认查找指定目录，默认值时 node_modules。</p> <h2 id="mode"><a href="#mode" class="header-anchor">#</a> mode</h2> <p>告诉 webpack 使用哪种模式的配置。'development' | 'production'</p> <h2 id="devtool"><a href="#devtool" class="header-anchor">#</a> devtool</h2> <p>配置 source-map。默认配置跟随 mode。</p> <p>source-map：加密代码与源代码的映射关系，方便调试定位源代码。</p> <p>hidden-source-map：生产环境可以配置成这个。与 source-map 相同，但不向 bundle 添加引用注释。可以通过 SourceMaps 从错误报告映射错误堆栈跟踪，并且浏览器开发工具查看不到源代码。</p> <p>nosources-source-map：生产环境可以配置成这个。生成的 map 文件不包含源码，但是会正确提示错误的行数。但是项目的目录结构和文件名称会暴露在 Sources 面板</p> <h2 id="optimization"><a href="#optimization" class="header-anchor">#</a> optimization</h2> <p>优化</p> <h3 id="optimization-splitchunks"><a href="#optimization-splitchunks" class="header-anchor">#</a> optimization.splitChunks</h3> <p>优化手段。</p> <p>code splitting，代码分割，可以将业务代码和第三方包分离。这样做的好处是，基本不变动的第三方包在用户端会有缓存，当我们软件更新时，用户端只需要下载更新业务代码。</p> <div class="language-js extra-class"><pre class="language-js"><code>splitChunks<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      chunks<span class="token punctuation">:</span> <span class="token string">'all'</span><span class="token punctuation">,</span> <span class="token comment">// 'async'， 默认值为 'initial'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>react 中只是简单的设置</p> <div class="language-js extra-class"><pre class="language-js"><code>splitChunks<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    chunks<span class="token punctuation">:</span> <span class="token string">&quot;all&quot;</span><span class="token punctuation">,</span>
    name<span class="token punctuation">:</span> isEnvDevelopment<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>vue 中会使用 cacheGroups 将第三方包改名为 vender</p> <h4 id="动态-import"><a href="#动态-import" class="header-anchor">#</a> 动态 import</h4> <p>动态 import 可以实现懒加载。动态 import 的文件会自动拆包(splitChunks)，因为动态请求时，文件不一定已经加载完成，所以不能与其他代码打包在一起。</p> <h4 id="splitchunks-minisize"><a href="#splitchunks-minisize" class="header-anchor">#</a> splitChunks.miniSize</h4> <p>如果拆包后的文件达不到设置值，则不会拆包。也就是说，设置 miniSize 后，拆分后文件必须大于这个值才会拆分。</p> <h4 id="splitchunks-maxsize"><a href="#splitchunks-maxsize" class="header-anchor">#</a> splitChunks.maxSize</h4> <p>体积大于 maxSize 才进行拆分。</p> <p>maxSize 的优先级高于 maxInitialRequest/maxAsyncRequests。实际的优先级是 maxInitialRequest/maxAsyncRequests &lt; maxSize &lt; minSize。</p> <h4 id="splitchunks-minchunks"><a href="#splitchunks-minchunks" class="header-anchor">#</a> splitChunks.minChunks</h4> <p>至少要被引用 x 次。优先级没有 maxSize，miniSize 高。</p> <h4 id="splitchunks-cachegroups"><a href="#splitchunks-cachegroups" class="header-anchor">#</a> splitChunks.cacheGroups</h4> <div class="language-js extra-class"><pre class="language-js"><code>cacheGroups<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        defaultVendors<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          <span class="token comment">// 当 webpack 处理文件路径时，在 Unix 系统中总是包含/，在 Windows 系统中总是包含\。这就是为什么在{cacheGroup}中使用[\\/]。</span>
          test<span class="token punctuation">:</span> <span class="token regex">/[\\/]node_modules[\\/]/</span><span class="token punctuation">,</span>
          <span class="token comment">// 如果有文件同时满足两个设置，则需要使用优先级来判断使用哪个</span>
          priority<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span>
          reuseExistingChunk<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token comment">// 修改拆包后的文件名</span>
          filename<span class="token punctuation">:</span> <span class="token string">'js/[id]_vender.js'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
          minChunks<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
          priority<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span>
          reuseExistingChunk<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="optimization-runtimechunk"><a href="#optimization-runtimechunk" class="header-anchor">#</a> optimization.runtimeChunk</h3> <p>把一些与文件源码无关的，webpack 打包生成的代码单独抽离成一个文件。</p> <h3 id="optimization-minimize"><a href="#optimization-minimize" class="header-anchor">#</a> optimization.minimize</h3> <p>告诉 webpack 使用 TerserPlugin 或在 optimization.minimizer 中指定的插件来最小化 bundle。</p> <h3 id="optimization-minimizer"><a href="#optimization-minimizer" class="header-anchor">#</a> optimization.minimizer</h3> <p>压缩模块，对文件进行压缩。对于 js 文件来说可以使用 TerserWebpackPlugin，css 文件可以使用 CssMinimizerWebpackPlugin。</p> <h2 id="tree-shaking"><a href="#tree-shaking" class="header-anchor">#</a> tree-shaking</h2> <p>优化手段。</p> <p>基于 ESM 的静态分析实现，将一些不用的代码（导出了，但是没有地方有导入使用，dead-code）从打包流程中剔除。它是一组搭配使用后的优化效果，不是某个配置选项，在生产模式下自动启用。</p> <h4 id="usedexports"><a href="#usedexports" class="header-anchor">#</a> usedExports</h4> <p>optimization.usedExports，标记出哪些代码没有被使用，清理还需要通过设置 optimization.minimize，通过 TerserWebpackPlugin 插件压缩代码。</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">//...</span>
    optimization<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        usedExports<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        minimizer<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">TerserPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="sideeffects"><a href="#sideeffects" class="header-anchor">#</a> sideEffects</h4> <p>optimization.sideEffects 开启。 package.json sideEffects 标记保留文件。</p> <p>使用 sideEffects 的前提是确保文件中没有副作用代码。因为如果有副作用代码，而被删除了的话，就会导致程序出错。这里的副作用代码指除了导出成员外所做的事情(比如在 window 上挂载)。</p> <p>false 为删除副作用代码，true 为保留。数组中配置路径，可以有选择的保留哪些副作用，可以通过这种方式来选择保留一些需要的 js 和 css 代码。不过 一般而言，可以在 配置 css 相关 loader 的地方，跟 test, use 同级下增加 sideEffects: true，来保留 css。</p> <p>这两种不是替代的关系。</p> <p>tree-shaking 的前提是必须使用 ESM。但是 babel 中的 preset-env 会将 ESM 转换成 CMJ。webpack 拿到 转换后的代码，就不能执行 tree-shaking 了(最新版 babel 已经支持 ESM，它会禁用 ESM-&gt;CMJ 的转换，所以 webpack 能使用 tree-shaking)。</p> <h3 id="prefetch-preload"><a href="#prefetch-preload" class="header-anchor">#</a> prefetch preload</h3> <p>prefetch：预加载，在浏览器空闲时间加载文件。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackPrefetch: true */</span> <span class="token string">&quot;./path/to/LoginModal.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>preload：会与父块并行加载。</p> <p>区别：</p> <ol><li>preload chunk 会在父 chunk 加载时，以并行方式开始加载，prefetch chunk 会在父 chunk 加载结束后开始加载。</li> <li>preload chunk 具有中等优先级，并立即下载。prefetch chunk 在浏览器闲置时下载。</li> <li>preload chunk 会在父 chunk 中立即请求，用于当下时刻。prefetch chunk 会用于未来的某个时刻。</li> <li>浏览器支持程度不同。</li></ol> <h2 id="externals"><a href="#externals" class="header-anchor">#</a> externals</h2> <p>优化手段。</p> <p>可以将一些基本不变的包排除在打包范围外，放在服务器上请求，常与 CDN 配合使用。排除在外的文件，需要在 public/index.html 模板文件中添加资源在 cdn 上的地址。</p> <p>这样做可以优化打包速度。对于部署在 cdn 上的包来说，一般也都是基本不变的资源，用户在请求一次之后后续都会有缓存的。</p> <p>cdn 优点：通过中心平台的负载均衡、内容分发、调度等功能模块，使用户就近获取所需内容，降低网络拥塞，提高用户访问响应速度和命中率。</p> <h2 id="dll"><a href="#dll" class="header-anchor">#</a> dll</h2> <p>优化手段。</p> <p>仅做了解，在 webpackv4 起已经不需要通过 dll 来优化打包速度了。vue/react 中已移除 dll 打包操作。</p> <p>与 externals 排除包然后放在 cdn 上有点类似。将一些不常改变的包移动到单独的编译中，进行单独的打包操作(单独起一个项目，引入包进行打包操作)，生成 dll 库，后续可以直接引入。减少项目打包时间。</p> <h2 id="webpack-打包库"><a href="#webpack-打包库" class="header-anchor">#</a> webpack 打包库</h2> <div class="language-js extra-class"><pre class="language-js"><code>output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    filename<span class="token punctuation">:</span> <span class="token string">'xx.js'</span><span class="token punctuation">,</span>
    <span class="token comment">// js 通用模块定义规范，能让 js 在所有环境下工作</span>
    libraryTarget<span class="token punctuation">:</span> <span class="token string">'umd'</span><span class="token punctuation">,</span>
    <span class="token comment">// 全局变量名，类似于 JQuery 的 $，库的变量方法都通过这里的设置来访问</span>
    library<span class="token punctuation">:</span> <span class="token string">'xx'</span><span class="token punctuation">,</span>
    <span class="token comment">// 一般都写 this，在 web 端指向 window</span>
    globalObject<span class="token punctuation">:</span> <span class="token string">'this'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="暴露-react-的-webpack-配置"><a href="#暴露-react-的-webpack-配置" class="header-anchor">#</a> 暴露 react 的 webpack 配置</h2> <p>npm run eject</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// package.json</span>
script<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    eject<span class="token punctuation">:</span> react<span class="token operator">-</span>scripts eject
<span class="token punctuation">}</span>
</code></pre></div><h2 id="暴露-vue-的-webpack-配置"><a href="#暴露-vue-的-webpack-配置" class="header-anchor">#</a> 暴露 vue 的 webpack 配置</h2> <p>https://cli.vuejs.org/zh/guide/webpack.html#%E5%AE%A1%E6%9F%A5%E9%A1%B9%E7%9B%AE%E7%9A%84-webpack-%E9%85%8D%E7%BD%AE</p> <div class="language-js extra-class"><pre class="language-js"><code>vue inspect <span class="token operator">&gt;</span> output<span class="token punctuation">.</span>js
</code></pre></div><h2 id="其他-tips"><a href="#其他-tips" class="header-anchor">#</a> 其他 tips</h2> <ul><li>__dirname: 指向当前执行 js 文件的绝对路径，到文件夹为止。</li> <li>path.join: 将传入的参数拼接成一个路径。会自动使用平台特定的分隔符把参数连接(自动加'/')，并规范化生成的路径。</li> <li>path.resolve: 根据参数解析出一个绝对路径。根据参数从右往左，直到解析出一个绝对路径。</li> <li>process.cwd: 当前执行 node 命令时候的文件夹地址。</li> <li>如果 webpack 配置导出的是函数，其形参 env 的值可以就是 npm script 中的 --env 传入的值。</li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">12/28/2021, 3:04:46 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/engineering-module/003-使用nodejs开发自定义cli.html" class="prev">使用 nodejs 开发自定义 cli</a></span> <span class="next"><a href="/blog/engineering-module/005-配置eslint-prettier-githook.html">配置 eslint，prettier，githook</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.59dd1e58.js" defer></script><script src="/blog/assets/js/2.ed64cbc4.js" defer></script><script src="/blog/assets/js/22.2ee2d1ab.js" defer></script>
  </body>
</html>
