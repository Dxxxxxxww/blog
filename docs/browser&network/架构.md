# 架构，以 Chrome 为例，介绍现代浏览器的实现架构

## 浏览器多进程

chrome 浏览器主要包括以下 4 个进程：

[comment]: <> (1. 浏览器进程：主要负责界面显示、用户交互、子进程管理、存储功能；)

[comment]: <> (2. 渲染进程：每个 tab 页都会有一个渲染进程，都是运行在沙箱环境，Chrome 还会尽量给每个站点新开一个渲染器进程，包括 iframe 中的站点，以实现站点隔离；)

[comment]: <> (3. GPU 进程：初衷是为了实现 3D CSS 效果，随后 UI 页面都采用 GPU 来挥之，这使得 GPU 成为浏览器的普遍需求；)

[comment]: <> (4. 网络进程：主要负责页面的网络资源加载；)

[comment]: <> (5. 插件进程：主要负责插件运行。)

1. 浏览器进程：控制浏览器这个应用的 chrome（主框架）部分，包括地址栏、书签、前进/后退按钮等，同时也会处理浏览器不可见的高权限任务，如发送**网络请求**、**访问文件**。
2. 渲染器进程：负责在标签页中显示网站及处理事件。每个 tab 页都会有一个渲染进程。
3. 插件进程：控制网站用到的所有插件。
4. GPU 进程：在独立的进程中处理 GPU 任务。之所以放到独立的进程，是因为 GPU 要处理来自多个应用的请求，但要在同一个界面上绘制图形。

当然，还有其他进程，比如扩展进程、实用程序进程。可以在浏览器的 "更多工具->任务管理器" 中查看。

### 多进程的优点

1. 稳定性。每一个 tab 页都会有一个渲染进程。如果当有一个 tab 页的渲染器崩溃了，只要关掉它就行了，不会影响到其他页面；
2. 安全性。操作系统有限制进程特权的机制。浏览器可以借此限制某些进程的能力。比如，Chrome 会限制处理任意用户输入的渲染器进程，不让它任意访问文件。

---

网站都会用到图片、CSS 和 JavaScript 等外部资源。浏览器需要从缓存或网络加载这些文件。主线程可以在解析并构建 DOM 的过程中发现一个加载一个，但这样效率太低。为此，Chrome 会在解析同时并发运行“预加载扫描器”，当发现 HTML 文档中有<img>或<link>时，预加载扫描器会将请求提交给浏览器进程中的网络线程(现在是独立的网络进程了)。

也就是说，请求获取 css img 不会阻塞加载。
