# 闭包

## 前置知识

在 ES6 之前，ES 中的作用域分为全局作用域和函数作用域。

## 闭包定义

闭包就是一个函数内部使用了不属于这个函数作用域内的变量。从这个定义出发，如果我们一个函数使用了全局变量，其实也算是一种"广义上的闭包"。但是我们大部分时候讨论的还是狭义上的闭包，也就是子级函数使用了父级函数作用域中的变量，这样一来，当父级函数调用结束，从执行上下文栈中移除，而子级函数还保留着父级作用域变量的引用，导致变量不能被垃圾回收，形成了闭包。

并不一定要子级函数作为返回值返回出去，在外部调用才算闭包，在父级函数内部调用，也算是闭包。

## 闭包形成原理

在 js 中，当函数执行生成上下文（此时内部代码还没有真正开始执行），引擎会对内部代码进行扫描，发现函数内部还有函数，并且引用了外部函数的变量，就会判断这是一个闭包，会在内存中额外开辟一个闭包空间来存放引用的变量。父级，子级函数都会持有这个闭包空间的引用。

## 闭包的作用

1. 缓存
2. 防抖节流
3. 私有变量
4. 早期模块化，iife + 闭包
