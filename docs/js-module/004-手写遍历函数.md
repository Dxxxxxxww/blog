# 手写 array 遍历函数

## forEach

```js
Array.prototype.forEach =
  Array.prototype.forEach ||
  function(fn) {
    // 不能使用箭头函数。否则 this 不会指向数组
    const arr = this
    for (let i = 0, len = arr.length; i < len; i++) {
      fn(arr[i], i, arr)
    }
  }
```

## filter

```js
Array.prototype.filter =
  Array.prototype.filter ||
  function(fn) {
    const arr = this,
      result = []
    for (let i = 0, len = arr.length; i < len; i++) {
      const val = arr[i]
      if (fn(val, i, arr)) {
        result.push(val)
      }
    }
    return result
  }
```

## map

```js
Array.prototype.map =
  Array.prototype.map ||
  function(fn) {
    const arr = this,
      result = []
    for (let i = 0, len = arr.length; i < len; i++) {
      const val = arr[i]
      result.push(fn(val, i, arr))
    }
    return result
  }
```

## every

```js
Array.prototype.every =
  Array.prototype.every ||
  function(fn) {
    const arr = this
    let result = true
    for (let i = 0, len = arr.length; i < len; i++) {
      const val = arr[i]
      result = fn(val, i, arr)
      if (!result) {
        break
      }
    }
    return result
  }
```

## some

```js
Array.prototype.some =
  Array.prototype.some ||
  function(fn) {
    const arr = this
    let result = false
    for (let i = 0; i < arr.length; i++) {
      result = fn(arr[i], i, arr)
      if (result) {
        break
      }
    }
    return result
  }
```

## reduce

```js
// 先做环境嗅探
Array.prototype.reduce =
  Array.prototype.reduce ||
  function r2(callback, initVal) {
    // 存一下调用 reduce 的数组
    const arr = this
    // 判断是否传入初始默认值
    const isHasInitVal = arguments.length > 1
    // 如果有默认值取默认值，没有默认值取数组第一位为默认值
    let base = isHasInitVal ? initVal : arr[0]
    // 如果有默认值，数组从 0 开始遍历，如果没有默认值，数组从 1 开始遍历
    const startIndex = isHasInitVal ? 0 : 1
    // 取一下数组
    arr.slice(startIndex).forEach((val, index) => {
      // callback 的参数，上一个值，当前值，当前值的index，数组
      base = callback(base, val, index + startIndex, arr)
    })
    return base
  }
```
