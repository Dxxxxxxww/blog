# 手写 new

new 做了哪些工作：

1. 创建对象；
2. 绑定原型；
3. 处理内部 this 指向；
4. 返回对象。

```js
function objectFactory(constructor) {
  const obj = myOc(constructor.prototype)
  // 绑定属性，处理 this 指向
  const res = constructor.apply(obj, Array.prototype.slice.call(arguments, 1))
  if (typeof res === 'object' || typeof res === 'function') {
    return res
  }
  return obj
}
// Object.create 传入一个对象，作为返回结果的 __proto__
// Object.create 的实现
function myOc(p) {
  // 建立中间函数
  const temp = function () {}
  // 获取原型
  temp.prototype = p
  // 创建对象 这里使用 new 来模拟 Object.create ，这在 new 中感觉有点尴尬，下面使用新的方式
  const obj = new temp()
  return obj
}

function Foo(a) {
  this.a = a
}

console.log(new Foo('123'))
console.log(objectFactory(Foo, '123'))

// Foo { a: '123' }
// Foo { a: '123' }
```

```js
// Object.create 的实现
function myOc(o, p) {
  Object.setPrototypeOf(o, p)
  return o
}

function myNew(constructor) {
  const o = {}
  myOc(o, constructor.prototype)
  const res = constructor.apply(o, Array.prototype.slice.call(arguments, 1))
  if (typeof res === 'object' || typeof res === 'function') {
    return res
  }
  return o
}
```
