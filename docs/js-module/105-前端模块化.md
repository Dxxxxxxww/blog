# 前端模块化

## 概述

模块化是把复杂的代码按照功能的不同划分为不同的模块来单独维护，提高开发效率，降低维护成本的一种思想。

## 模块化规范

-   AMD(异步模块定义，浏览器端)：淘汰了
-   CMD(通用模块定义，浏览器端)：淘汰了
-   ESM(浏览器端)：ES 在语言层面实现的
-   CommonJS 规范(node 端)：以同步模式加载模块

### ESM 特性

通过给 script 添加 type="module" 的属性，就可以以 ESM 的标准执行其中的 JS

1. ESM 自动采用严格模式；
2. 每个 ESM 都是私有作用域；
3. ESM 是通过 CORS 的方式请求外部 JS 模块；

```html
<script type="module" src="支持cors的链接"></script>
```

4. ESM 的 script 会延时执行脚本，相当于添加了 defer。

#### defer async

defer 属性的运行流程如下。

1. 浏览器开始解析 HTML 网页。
2. 解析过程中，发现带有 defer 属性的\<script\>元素。
3. 浏览器继续往下解析 HTML 网页，同时并行下载\<script\>元素加载的外部脚本。
4. 浏览器完成解析 HTML 网页，此时再回过头执行已经下载完成的脚本。

async 属性的作用是，使用另一个进程下载脚本，下载时不会阻塞渲染。

1. 浏览器开始解析 HTML 网页。
2. 解析过程中，发现带有 async 属性的 script 标签。
3. 浏览器继续往下解析 HTML 网页，同时并行下载\<script\>标签中的外部脚本。
4. 脚本下载完成，浏览器暂停解析 HTML 网页，开始执行下载的脚本。
5. 脚本执行完毕，浏览器恢复解析 HTML 网页。

## require/exports import/export 的区别

1. 输出的区别

    require/exports 输出的是值的拷贝。
    import/export 输出的是引用。

2. 加载的区别

    CommonJS 加载的是一个对象（即 module.exports 属性），该对象只有在脚本运行完才会生成。而 ES6 模块不是对象，它的对外接口只是一种静态定义，在代码静态解析阶段就会生成。

### 注意事项

ESM 导入导出不是解构，是固定语法。

```js
// export 导出的不是一个字面量对象，{} 是固定语法，提取模块中的命名成员
export { a }
// 导出字面量是不行的
export 123 // 报错

import { a } form 'xx' // 这里的 {} 不是解构
```

---

Commonjs 始终只会导出一个默认成员

---

原生 node 环境中(8.5 以上)，实验特性支持 ESM 导入 Commonjs，不支持 Commonjs 导入 ESM
