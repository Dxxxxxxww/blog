# vue 模块

此模块为 vue 模块。

- 0xx：vue
- 2xx：vue-router
- 3xx：vuex
- 4xx：vue-cli
- 5xx：vue-loader
- 8xx：问题以及一些杂七杂八的东西
- 9xx：源码，源码最后需要统一整理到前面几个目录中

大厂里面做埋点一般有两种模式，一种是手动埋点，一种是无痕埋点.

手动埋点，就根据需求在指定位置加上埋点函数就可了，比如「添加购物」按钮，点击一次，就需要发一次埋点信息，那么就让研发同学去添加一下代码就好了.这种是比较常见的操作。

还有一种是无痕埋点，无痕埋点的意思就是不需要通过显式的添加代码的方式自动收集埋点信息。这种方式一般是去拦截事件函数，比如 onclick ontouch onscroll，然后将操作信息发送到后端。这样做数据量肯定会很大。然后在管理后台系统，去清晰筛选对应的信息，拿到数据结果。好处是不需要提前埋点就能获取业务信息。
Q:这个指的是我们利用冒泡在根标签进行拦截吗？
A:对，这是无痕的，没必要做哈。。

如果是自己做的话，建议拦截所有 api 请求，做统计上报.具体拦截方式可以参照 sentry

如果你是要做关键接口的一个性能统计，成功率统计，不应该使用埋点 sdk，应该用性能统计的 sdk

整个页面记录用户行为标志，在固定时间段/生命周期里总和后调用 api。怎么去考虑业务 api 与埋点 api 之间的性能平衡？
——————
这里是想做 hook 生命周期做无痕埋点对吧？
埋点 api，应该在系统闲置时调用，不应该阻塞线程。

那么有哪几种方式，同学们知道吗？

1. requestIdleCallback 这个钩子可以嘛
2. navigator.sendbeacon.这个是专门设计用于发送统计信息的 api.你只要调用了，浏览器就会保证帮你发送过去，即便页面立刻被关闭了，也会保证发送完成.兼容性还可以.如果 sendbeacon 不能用，降级方案，就得考虑 requestIdleCallback => requestanimationframe => setTimeout 然后批量发送请求.调用的时候注意降级处理。。做下兼容.部分 Android 运行环境是不支持的.

这个比较麻烦。
一个管理后台，然后用户可以点一个元素，然后标记埋点，取个名字。这个时候存一下 xpath 到数据库。。然后埋点信息收集上来后，结合 xpath 做清洗.找一下对应的埋点信息。。这里 xpath 要尽量固定。。

xpath 大家直到不？尽量要做唯一。。。一般而言，做 ui 测试之类的，都是用 xpath。。。ios 啊 Android 啊 也是 xpath

## 埋点类型

埋点分为手动埋点，无痕埋点。

- 手动埋点：就是在指定位置加上埋点函数。比如说按钮事件，比如说重要的接口处。缺点：较为繁琐。优点：准确性高
- 无痕埋点：就是在 document.documentElement 上通过冒泡拦截所有事件，click，change，input 等。缺点：冗杂信息庞大。优点：不需要手动添加。

**目前的优解是拦截所有 api 请求，做统计上报.具体拦截方式可以参照 sentry。**

## 埋点调用时机

埋点应该在系统闲置时调用，不应该阻塞线程。

使用方式是通过一个可降级函数来发送埋点请求。

降级函数中的 api 优先级：

1. navigator.sendbeacon
2. requestIdleCallback
3. requestanimationframe
4. setTimeout

对于一个管理后台而言，可以使用记录 xpath 的方式来进行埋点。比如，用户可以点一个元素，然后标记埋点，取个名字。这个时候存一下 xpath 到数据库。然后埋点信息收集上来后，结合 xpath 做清洗。找一下对应的埋点信息。需要注意的是， xpath 尽量要唯一。

js 获取 xpath 方式：

```js
function getXPath(node) {
  if (node.hasAttribute('id')) {
    return '//' + node.tagName + '[@id="' + node.id + '"]'
  }

  if (node.hasAttribute('class')) {
    return '//' + node.tagName + '[@class="' + node.getAttribute('class') + '"]'
  }

  var old = '/' + node.tagName
  var new_path = this.xpath(node.parentNode) + old

  return new_path
}
```
