## iframe 请求第三方网页

用 node 来做一层代理

## 拦截网络请求

axios 底层是 xhr， 拦截 xhr.prototype.open, xhr.prototype.send 指向新的函数，来改 url。

fetch 是 native 原生实现的，可以重写 window.fetch 来拦截。

### 压测工具

wrk node-wrk，注意不是跑自己机器，跑服务器的。把 node 部署到服务器后，在本地跑 wrk 去测试服务器。

### 用 node 来做会不会有并发压力？

分流+加机器+缓存（返回的这个 iframe 一段时间内比如说 10min 都不重新请求）

### 代理劫持

无法防范。http 请求能改，js 能改，接口拦截，所以无法防范。例子，假银行钓鱼网站。

### node 场景

前端 node 能抢业务抢业务。抢不到就去做 bff，前端功能增强，比如统一代理，统一静态资源管理，统一部署。

### 微前端 iframe

微前端的安全性高于 iframe

### 原本业务使用 java 作为服务端，针对这个 iframe 需求，搞了一个 node 的服务，两个服务是使用 nginx 来进行分流的？

是的，就是用 nginx

## 缓存

缓存是为了解决流量问题。流量：用户访问量，并发量。

html：no-cache，或者 10min / 1h。

js/css 文件：hash-名称，强缓存，max-age 给十年。

图片/视频资源文件：hash-名称，强缓存，max-age 给十年。

### etag 和 last-modified 优先级？

规范本身没有定义，看服务端处理，一般来说 etag > last-modified

### service worker

国内没什么用，因为国内 pwa 用的很少。

最厉害的特点就是可以拦截本地请求。

[ServiceWorker API 模拟了 tcp 网络栈，然后在浏览器中运行 node http server](https://blog.stackblitz.com/posts/introducing-webcontainers/)。 没完全开源。

### memory cache

过期时间并不稳定，有时候关闭 tab 重新打开，缓存依然生效。
